<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Paid Ads Reporting Tool</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&amp;family=Inter:wght@400;500;600&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; }
    .heading-font { font-family: 'Space Grotesk', sans-serif; }
    
    @media print {
      @page {
        size: A4 portrait;
        margin: 0;
      }
      body * {
        visibility: hidden;
      }
      #report-page, #report-page * {
        visibility: visible;
      }
      #report-page {
        position: absolute;
        left: 0;
        top: 0;
        width: 210mm;
        height: 297mm;
        padding: 15mm;
        box-sizing: border-box;
      }
      .no-print {
        display: none !important;
      }
    }
    
    .donut-chart {
      transform: rotate(-90deg);
    }
    
    .table-input:focus {
      outline: none;
      background: #f0f9ff;
    }
    
    .paste-area {
      min-height: 200px;
      font-family: monospace;
      font-size: 12px;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%);
    }
    
    .card-gradient {
      background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-slate-900 overflow-auto">
  <div id="app-container" class="w-full min-h-full"><!-- Page 1: Landing -->
   <div id="page-1" class="min-h-full gradient-bg flex flex-col items-center justify-center p-8">
    <div class="max-w-2xl text-center">
     <div class="mb-8">
      <svg class="w-20 h-20 mx-auto mb-6" viewbox="0 0 80 80" fill="none"><circle cx="40" cy="40" r="38" stroke="#3b82f6" stroke-width="4" fill="none" /> <path d="M25 45 L35 55 L55 30" stroke="#10b981" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none" /> <circle cx="40" cy="40" r="20" stroke="#60a5fa" stroke-width="2" stroke-dasharray="8 4" fill="none" />
      </svg>
     </div>
     <h1 id="main-heading" class="heading-font text-4xl md:text-5xl font-bold text-white mb-4">Paid Ads Reporting Tool</h1>
     <p id="sub-heading" class="text-lg text-slate-300 mb-10 leading-relaxed">Create reports in &lt;10 mins and focus your time on presenting the data.</p><button onclick="showPage(2)" class="px-8 py-4 bg-blue-600 hover:bg-blue-500 text-white font-semibold rounded-xl shadow-lg shadow-blue-600/30 transition-all transform hover:scale-105"> Create Report ‚Üí </button>
    </div>
    <div class="absolute bottom-8 text-slate-500 text-sm">
     Click on the Create Report button to create a new report
    </div>
   </div><!-- Page 2: Data Input -->
   <div id="page-2" class="min-h-full gradient-bg p-6 hidden">
    <div class="max-w-5xl mx-auto"><button onclick="showPage(1)" class="mb-6 text-slate-400 hover:text-white flex items-center gap-2 transition-colors"> ‚Üê Back to Home </button>
     <div class="card-gradient rounded-2xl shadow-2xl p-8">
      <h2 class="heading-font text-2xl font-bold text-slate-800 mb-6">Report Details</h2><!-- Basic Info -->
      <div class="grid md:grid-cols-3 gap-4 mb-8">
       <div><label class="block text-sm font-medium text-slate-600 mb-2">Brand Name *</label> <input type="text" id="brand-name" placeholder="Enter brand name" class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
       </div>
       <div><label class="block text-sm font-medium text-slate-600 mb-2">Presenter Name (Optional)</label> <input type="text" id="presenter-name" placeholder="Enter presenter name" class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
       </div>
       <div><label class="block text-sm font-medium text-slate-600 mb-2">Reporting Period *</label> <input type="text" id="reporting-period" placeholder="e.g., Jan 2024 - Mar 2024" class="w-full px-4 py-3 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
       </div>
      </div><!-- Data Input Method Tabs -->
      <div class="mb-6">
       <h3 class="heading-font text-lg font-semibold text-slate-800 mb-4">Platform Performance Data</h3>
       <div class="flex gap-2 mb-4"><button onclick="switchInputMethod('table')" id="tab-table" class="px-4 py-2 rounded-lg font-medium transition-all bg-blue-600 text-white"> üìã Paste from Excel/Sheets </button> <button onclick="switchInputMethod('manual')" id="tab-manual" class="px-4 py-2 rounded-lg font-medium transition-all bg-slate-200 text-slate-600 hover:bg-slate-300"> ‚úèÔ∏è Manual Entry </button>
       </div>
      </div><!-- Paste Method -->
      <div id="input-table" class="mb-6">
       <div class="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-4">
        <p class="text-sm text-amber-800"><strong>Format:</strong> Copy data from Excel/Sheets with columns: Platform, Results, Impressions, Clicks, Cost(‚Çπ)<br><span class="text-amber-600">Tab-separated values will be automatically parsed.</span></p>
       </div><textarea id="paste-area" class="w-full paste-area p-4 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Paste your data here...

Example:
Google Ads	150	50000	2500	25000
Meta Ads	200	80000	3500	30000
LinkedIn Ads	75	20000	1000	15000"></textarea> <button onclick="parseTableData()" class="mt-3 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-all"> Parse Data </button>
      </div><!-- Manual Entry Method -->
      <div id="input-manual" class="mb-6 hidden">
       <div class="overflow-x-auto">
        <table class="w-full border-collapse">
         <thead>
          <tr class="bg-slate-100">
           <th class="px-3 py-2 text-left text-sm font-semibold text-slate-700 border">Platform</th>
           <th class="px-3 py-2 text-left text-sm font-semibold text-slate-700 border">Results</th>
           <th class="px-3 py-2 text-left text-sm font-semibold text-slate-700 border">Impressions</th>
           <th class="px-3 py-2 text-left text-sm font-semibold text-slate-700 border">Clicks</th>
           <th class="px-3 py-2 text-left text-sm font-semibold text-slate-700 border">Cost (‚Çπ)</th>
           <th class="px-3 py-2 text-center text-sm font-semibold text-slate-700 border w-12"></th>
          </tr>
         </thead>
         <tbody id="manual-table-body"><!-- Rows added dynamically -->
         </tbody>
        </table>
       </div><button onclick="addManualRow()" class="mt-3 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition-all"> + Add Platform </button>
      </div><!-- Data Preview -->
      <div id="data-preview" class="mb-6 hidden">
       <h4 class="font-semibold text-slate-700 mb-3">üìä Data Preview</h4>
       <div class="overflow-x-auto bg-slate-50 rounded-lg p-4">
        <table class="w-full text-sm">
         <thead>
          <tr class="border-b border-slate-300">
           <th class="px-3 py-2 text-left font-semibold">Platform</th>
           <th class="px-3 py-2 text-right font-semibold">Results</th>
           <th class="px-3 py-2 text-right font-semibold">Impressions</th>
           <th class="px-3 py-2 text-right font-semibold">Clicks</th>
           <th class="px-3 py-2 text-right font-semibold">Cost (‚Çπ)</th>
          </tr>
         </thead>
         <tbody id="preview-body"></tbody>
        </table>
       </div>
      </div><!-- Key Pointers -->
      <div class="mb-8"><label class="block text-sm font-medium text-slate-600 mb-2">Key Pointers (Performance Insights)</label>
       <div id="pointers-container">
        <div class="flex gap-2 mb-2"><input type="text" class="pointer-input flex-1 px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter key insight or observation..."> <button onclick="addPointer()" class="px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500">+</button>
        </div>
       </div>
      </div><!-- Generate Button -->
      <div class="text-center"><button onclick="generateReport()" class="px-10 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all transform hover:scale-105"> Generate Report ‚Üí </button>
       <p id="error-msg" class="mt-3 text-red-500 text-sm hidden"></p>
      </div>
     </div>
    </div>
   </div><!-- Page 3: Report -->
   <div id="page-3" class="min-h-full bg-white p-6 hidden">
    <div class="no-print max-w-4xl mx-auto mb-4 flex gap-3"><button onclick="showPage(2)" class="px-4 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-all"> ‚Üê Edit Report </button> <button onclick="downloadPDF()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-500 transition-all font-medium"> üì• Download PDF </button>
    </div><!-- A4 Report Container -->
    <div id="report-page" class="mx-auto bg-white shadow-2xl" style="width: 210mm; min-height: 297mm; padding: 15mm; box-sizing: border-box;"><!-- Section 1: Header -->
     <div id="report-header" class="text-center mb-8 pb-6 border-b-2 border-slate-200">
      <h1 id="report-brand" class="heading-font text-3xl font-bold text-slate-800 mb-2"></h1>
      <p id="report-period" class="text-lg text-slate-600 mb-1"></p>
      <p id="report-presenter" class="text-sm text-slate-500"></p>
     </div><!-- Section 2: Charts -->
     <div id="report-charts" class="mb-8">
      <h2 class="heading-font text-xl font-bold text-slate-700 mb-4">Performance Overview</h2>
      <div class="flex gap-6"><!-- LHS: Big Results Donut -->
       <div class="flex-shrink-0">
        <div class="text-center mb-2"><span class="text-sm font-semibold text-slate-600">Results by Platform</span>
        </div>
        <svg id="chart-results" width="190" height="190" viewbox="0 0 190 190"></svg>
        <div id="legend-results" class="mt-2 text-xs"></div>
       </div><!-- RHS: Cost, Impressions, Clicks -->
       <div class="flex-1">
        <div class="mb-4">
         <div class="text-center mb-1"><span class="text-xs font-semibold text-slate-600">Cost Distribution</span>
         </div>
         <svg id="chart-cost" width="120" height="120" viewbox="0 0 120 120" class="mx-auto"></svg>
         <div id="legend-cost" class="mt-1 text-xs text-center"></div>
        </div>
        <div class="flex gap-4 justify-center">
         <div class="text-center"><span class="text-xs font-semibold text-slate-600 block mb-1">Impressions</span>
          <svg id="chart-impressions" width="80" height="80" viewbox="0 0 80 80"></svg>
         </div>
         <div class="text-center"><span class="text-xs font-semibold text-slate-600 block mb-1">Clicks</span>
          <svg id="chart-clicks" width="80" height="80" viewbox="0 0 80 80"></svg>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Section 3: Data Table -->
     <div id="report-table-section" class="mb-6">
      <h2 class="heading-font text-xl font-bold text-slate-700 mb-3">Detailed Metrics</h2>
      <table class="w-full text-sm border-collapse">
       <thead>
        <tr class="bg-slate-700 text-white">
         <th class="px-2 py-2 text-left font-semibold">Platform</th>
         <th class="px-2 py-2 text-right font-semibold">Results</th>
         <th class="px-2 py-2 text-right font-semibold">Cost (‚Çπ)</th>
         <th class="px-2 py-2 text-right font-semibold">Impr.</th>
         <th class="px-2 py-2 text-right font-semibold">Clicks</th>
         <th class="px-2 py-2 text-right font-semibold">CPR (‚Çπ)</th>
         <th class="px-2 py-2 text-right font-semibold">Result Rate</th>
         <th class="px-2 py-2 text-right font-semibold">CTR</th>
         <th class="px-2 py-2 text-right font-semibold">CPC (‚Çπ)</th>
        </tr>
       </thead>
       <tbody id="report-table-body"></tbody>
       <tfoot id="report-table-footer"></tfoot>
      </table>
     </div><!-- Key Pointers -->
     <div id="report-pointers" class="bg-slate-50 rounded-lg p-4">
      <h3 class="heading-font font-bold text-slate-700 mb-2">üìå Key Insights</h3>
      <ul id="pointers-list" class="list-disc list-inside text-sm text-slate-600 space-y-1"></ul>
     </div>
    </div>
   </div>
  </div>
  <script>
    // Config and SDK setup
    const defaultConfig = {
      main_heading: 'Paid Ads Reporting Tool',
      sub_heading: 'Create reports in <10 mins and focus your time on presenting the data.',
      primary_color: '#1e3a5f',
      secondary_color: '#3b82f6',
      text_color: '#1e293b',
      accent_color: '#10b981',
      background_color: '#0f172a'
    };
    
    let config = { ...defaultConfig };
    
    // Data storage
    let platformData = [];
    let keyPointers = [];
    
    // Chart colors
    const chartColors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16'];
    
    // Initialize SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (newConfig) => {
          config = { ...defaultConfig, ...newConfig };
          updateUI();
        },
        mapToCapabilities: (cfg) => ({
          recolorables: [
            { get: () => cfg.primary_color || defaultConfig.primary_color, set: (v) => { cfg.primary_color = v; window.elementSdk.setConfig({ primary_color: v }); } },
            { get: () => cfg.secondary_color || defaultConfig.secondary_color, set: (v) => { cfg.secondary_color = v; window.elementSdk.setConfig({ secondary_color: v }); } },
            { get: () => cfg.text_color || defaultConfig.text_color, set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); } },
            { get: () => cfg.accent_color || defaultConfig.accent_color, set: (v) => { cfg.accent_color = v; window.elementSdk.setConfig({ accent_color: v }); } },
            { get: () => cfg.background_color || defaultConfig.background_color, set: (v) => { cfg.background_color = v; window.elementSdk.setConfig({ background_color: v }); } }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (cfg) => new Map([
          ['main_heading', cfg.main_heading || defaultConfig.main_heading],
          ['sub_heading', cfg.sub_heading || defaultConfig.sub_heading]
        ])
      });
    }
    
    function updateUI() {
      document.getElementById('main-heading').textContent = config.main_heading || defaultConfig.main_heading;
      document.getElementById('sub-heading').textContent = config.sub_heading || defaultConfig.sub_heading;
    }
    
    // Page navigation
    function showPage(pageNum) {
      document.getElementById('page-1').classList.add('hidden');
      document.getElementById('page-2').classList.add('hidden');
      document.getElementById('page-3').classList.add('hidden');
      document.getElementById('page-' + pageNum).classList.remove('hidden');
      
      if (pageNum === 2) {
        initManualTable();
      }
    }
    
    // Input method switching
    function switchInputMethod(method) {
      const tabTable = document.getElementById('tab-table');
      const tabManual = document.getElementById('tab-manual');
      const inputTable = document.getElementById('input-table');
      const inputManual = document.getElementById('input-manual');
      
      if (method === 'table') {
        tabTable.className = 'px-4 py-2 rounded-lg font-medium transition-all bg-blue-600 text-white';
        tabManual.className = 'px-4 py-2 rounded-lg font-medium transition-all bg-slate-200 text-slate-600 hover:bg-slate-300';
        inputTable.classList.remove('hidden');
        inputManual.classList.add('hidden');
      } else {
        tabManual.className = 'px-4 py-2 rounded-lg font-medium transition-all bg-blue-600 text-white';
        tabTable.className = 'px-4 py-2 rounded-lg font-medium transition-all bg-slate-200 text-slate-600 hover:bg-slate-300';
        inputManual.classList.remove('hidden');
        inputTable.classList.add('hidden');
      }
    }
    
    // Initialize manual entry table
    function initManualTable() {
      const tbody = document.getElementById('manual-table-body');
      if (tbody.children.length === 0) {
        addManualRow();
        addManualRow();
        addManualRow();
      }
    }
    
    // Add row to manual table
    function addManualRow() {
      const tbody = document.getElementById('manual-table-body');
      const row = document.createElement('tr');
      row.innerHTML = `
        <td class="border"><input type="text" class="table-input w-full px-2 py-2" placeholder="Platform name"></td>
        <td class="border"><input type="number" class="table-input w-full px-2 py-2 text-right" placeholder="0"></td>
        <td class="border"><input type="number" class="table-input w-full px-2 py-2 text-right" placeholder="0"></td>
        <td class="border"><input type="number" class="table-input w-full px-2 py-2 text-right" placeholder="0"></td>
        <td class="border"><input type="number" class="table-input w-full px-2 py-2 text-right" placeholder="0"></td>
        <td class="border text-center">
          <button onclick="this.closest('tr').remove(); updatePreview();" class="text-red-500 hover:text-red-700 px-2">‚úï</button>
        </td>
      `;
      
      // Add change listeners
      row.querySelectorAll('input').forEach(input => {
        input.addEventListener('change', updatePreview);
        input.addEventListener('input', updatePreview);
      });
      
      tbody.appendChild(row);
    }
    
    // Parse pasted table data
    function parseTableData() {
      const pasteArea = document.getElementById('paste-area');
      const text = pasteArea.value.trim();
      
      if (!text) return;
      
      platformData = [];
      const lines = text.split('\n');
      
      lines.forEach(line => {
        const cols = line.split('\t');
        if (cols.length >= 5 && cols[0].trim()) {
          platformData.push({
            platform: cols[0].trim(),
            results: parseFloat(cols[1]) || 0,
            impressions: parseFloat(cols[2]) || 0,
            clicks: parseFloat(cols[3]) || 0,
            cost: parseFloat(cols[4]) || 0
          });
        }
      });
      
      showDataPreview();
    }
    
    // Update preview from manual entry
    function updatePreview() {
      platformData = [];
      const rows = document.querySelectorAll('#manual-table-body tr');
      
      rows.forEach(row => {
        const inputs = row.querySelectorAll('input');
        const platform = inputs[0].value.trim();
        if (platform) {
          platformData.push({
            platform,
            results: parseFloat(inputs[1].value) || 0,
            impressions: parseFloat(inputs[2].value) || 0,
            clicks: parseFloat(inputs[3].value) || 0,
            cost: parseFloat(inputs[4].value) || 0
          });
        }
      });
      
      showDataPreview();
    }
    
    // Show data preview
    function showDataPreview() {
      const preview = document.getElementById('data-preview');
      const previewBody = document.getElementById('preview-body');
      
      if (platformData.length === 0) {
        preview.classList.add('hidden');
        return;
      }
      
      preview.classList.remove('hidden');
      previewBody.innerHTML = platformData.map(d => `
        <tr class="border-b border-slate-200">
          <td class="px-3 py-2">${d.platform}</td>
          <td class="px-3 py-2 text-right">${d.results.toLocaleString()}</td>
          <td class="px-3 py-2 text-right">${d.impressions.toLocaleString()}</td>
          <td class="px-3 py-2 text-right">${d.clicks.toLocaleString()}</td>
          <td class="px-3 py-2 text-right">‚Çπ${d.cost.toLocaleString()}</td>
        </tr>
      `).join('');
    }
    
    // Add key pointer
    function addPointer() {
      const container = document.getElementById('pointers-container');
      const div = document.createElement('div');
      div.className = 'flex gap-2 mb-2';
      div.innerHTML = `
        <input type="text" class="pointer-input flex-1 px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500" 
          placeholder="Enter key insight or observation...">
        <button onclick="this.parentElement.remove()" class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-400">‚úï</button>
      `;
      container.appendChild(div);
    }
    
    // Generate report
    function generateReport() {
      const brandName = document.getElementById('brand-name').value.trim();
      const presenterName = document.getElementById('presenter-name').value.trim();
      const reportingPeriod = document.getElementById('reporting-period').value.trim();
      const errorMsg = document.getElementById('error-msg');
      
      // Collect manual data if not already collected
      if (platformData.length === 0) {
        updatePreview();
      }
      
      // Collect key pointers
      keyPointers = [];
      document.querySelectorAll('.pointer-input').forEach(input => {
        if (input.value.trim()) {
          keyPointers.push(input.value.trim());
        }
      });
      
      // Validation
      if (!brandName) {
        errorMsg.textContent = 'Please enter the Brand Name';
        errorMsg.classList.remove('hidden');
        return;
      }
      if (!reportingPeriod) {
        errorMsg.textContent = 'Please enter the Reporting Period';
        errorMsg.classList.remove('hidden');
        return;
      }
      if (platformData.length === 0) {
        errorMsg.textContent = 'Please enter at least one platform\'s data';
        errorMsg.classList.remove('hidden');
        return;
      }
      
      errorMsg.classList.add('hidden');
      
      // Populate report
      document.getElementById('report-brand').textContent = brandName;
      document.getElementById('report-period').textContent = reportingPeriod;
      document.getElementById('report-presenter').textContent = presenterName ? `Presented by: ${presenterName}` : '';
      
      // Generate charts
      generateDonutChart('chart-results', 'legend-results', platformData.map(d => ({ label: d.platform, value: d.results })), 95, true);
      generateDonutChart('chart-cost', 'legend-cost', platformData.map(d => ({ label: d.platform, value: d.cost })), 60, false);
      generateDonutChart('chart-impressions', null, platformData.map(d => ({ label: d.platform, value: d.impressions })), 40, false);
      generateDonutChart('chart-clicks', null, platformData.map(d => ({ label: d.platform, value: d.clicks })), 40, false);
      
      // Generate table
      generateDataTable();
      
      // Generate pointers
      const pointersList = document.getElementById('pointers-list');
      if (keyPointers.length > 0) {
        pointersList.innerHTML = keyPointers.map(p => `<li>${p}</li>`).join('');
        document.getElementById('report-pointers').classList.remove('hidden');
      } else {
        document.getElementById('report-pointers').classList.add('hidden');
      }
      
      showPage(3);
    }
    
    // Generate donut chart
    function generateDonutChart(svgId, legendId, data, radius, showLabels) {
      const svg = document.getElementById(svgId);
      const total = data.reduce((sum, d) => sum + d.value, 0);
      
      if (total === 0) {
        svg.innerHTML = `<text x="50%" y="50%" text-anchor="middle" fill="#94a3b8" font-size="12">No Data</text>`;
        return;
      }
      
      const cx = radius;
      const cy = radius;
      const innerRadius = radius * 0.55;
      const outerRadius = radius * 0.9;
      
      let currentAngle = -90;
      let paths = '';
      let labels = '';
      
      data.forEach((d, i) => {
        const percentage = d.value / total;
        const angle = percentage * 360;
        const startAngle = currentAngle;
        const endAngle = currentAngle + angle;
        
        const start = polarToCartesian(cx, cy, outerRadius, startAngle);
        const end = polarToCartesian(cx, cy, outerRadius, endAngle);
        const innerStart = polarToCartesian(cx, cy, innerRadius, startAngle);
        const innerEnd = polarToCartesian(cx, cy, innerRadius, endAngle);
        
        const largeArc = angle > 180 ? 1 : 0;
        
        paths += `<path d="M ${start.x} ${start.y} A ${outerRadius} ${outerRadius} 0 ${largeArc} 1 ${end.x} ${end.y} L ${innerEnd.x} ${innerEnd.y} A ${innerRadius} ${innerRadius} 0 ${largeArc} 0 ${innerStart.x} ${innerStart.y} Z" fill="${chartColors[i % chartColors.length]}"/>`;
        
        currentAngle = endAngle;
      });
      
      // Center text
      const totalFormatted = total >= 1000000 ? (total / 1000000).toFixed(1) + 'M' : 
                             total >= 1000 ? (total / 1000).toFixed(1) + 'K' : total.toLocaleString();
      
      svg.innerHTML = `
        ${paths}
        <text x="${cx}" y="${cy - 5}" text-anchor="middle" fill="#1e293b" font-size="${radius > 60 ? 14 : 10}" font-weight="bold">Total</text>
        <text x="${cx}" y="${cy + 12}" text-anchor="middle" fill="#1e293b" font-size="${radius > 60 ? 16 : 11}" font-weight="bold">${totalFormatted}</text>
      `;
      
      // Legend
      if (legendId) {
        const legend = document.getElementById(legendId);
        legend.innerHTML = data.map((d, i) => {
          const pct = ((d.value / total) * 100).toFixed(1);
          return `<span class="inline-flex items-center mr-3 mb-1">
            <span class="w-3 h-3 rounded-full mr-1" style="background:${chartColors[i % chartColors.length]}"></span>
            <span class="text-slate-600">${d.label}: ${pct}%</span>
          </span>`;
        }).join('');
      }
    }
    
    function polarToCartesian(cx, cy, r, angleDeg) {
      const angleRad = (angleDeg * Math.PI) / 180;
      return {
        x: cx + r * Math.cos(angleRad),
        y: cy + r * Math.sin(angleRad)
      };
    }
    
    // Generate data table
    function generateDataTable() {
      const tbody = document.getElementById('report-table-body');
      const tfoot = document.getElementById('report-table-footer');
      
      let totals = { results: 0, cost: 0, impressions: 0, clicks: 0 };
      
      tbody.innerHTML = platformData.map((d, i) => {
        totals.results += d.results;
        totals.cost += d.cost;
        totals.impressions += d.impressions;
        totals.clicks += d.clicks;
        
        const cpr = d.results > 0 ? (d.cost / d.results).toFixed(2) : '-';
        const resultRate = d.impressions > 0 ? ((d.results / d.impressions) * 100).toFixed(2) + '%' : '-';
        const ctr = d.impressions > 0 ? ((d.clicks / d.impressions) * 100).toFixed(2) + '%' : '-';
        const cpc = d.clicks > 0 ? (d.cost / d.clicks).toFixed(2) : '-';
        
        return `
          <tr class="${i % 2 === 0 ? 'bg-white' : 'bg-slate-50'}">
            <td class="px-2 py-2 border font-medium">
              <span class="inline-block w-3 h-3 rounded-full mr-2" style="background:${chartColors[i % chartColors.length]}"></span>
              ${d.platform}
            </td>
            <td class="px-2 py-2 border text-right">${d.results.toLocaleString()}</td>
            <td class="px-2 py-2 border text-right">‚Çπ${d.cost.toLocaleString()}</td>
            <td class="px-2 py-2 border text-right">${d.impressions.toLocaleString()}</td>
            <td class="px-2 py-2 border text-right">${d.clicks.toLocaleString()}</td>
            <td class="px-2 py-2 border text-right">‚Çπ${cpr}</td>
            <td class="px-2 py-2 border text-right">${resultRate}</td>
            <td class="px-2 py-2 border text-right">${ctr}</td>
            <td class="px-2 py-2 border text-right">‚Çπ${cpc}</td>
          </tr>
        `;
      }).join('');
      
      // Totals row
      const totalCpr = totals.results > 0 ? (totals.cost / totals.results).toFixed(2) : '-';
      const totalResultRate = totals.impressions > 0 ? ((totals.results / totals.impressions) * 100).toFixed(2) + '%' : '-';
      const totalCtr = totals.impressions > 0 ? ((totals.clicks / totals.impressions) * 100).toFixed(2) + '%' : '-';
      const totalCpc = totals.clicks > 0 ? (totals.cost / totals.clicks).toFixed(2) : '-';
      
      tfoot.innerHTML = `
        <tr class="bg-slate-200 font-bold">
          <td class="px-2 py-2 border">Total</td>
          <td class="px-2 py-2 border text-right">${totals.results.toLocaleString()}</td>
          <td class="px-2 py-2 border text-right">‚Çπ${totals.cost.toLocaleString()}</td>
          <td class="px-2 py-2 border text-right">${totals.impressions.toLocaleString()}</td>
          <td class="px-2 py-2 border text-right">${totals.clicks.toLocaleString()}</td>
          <td class="px-2 py-2 border text-right">‚Çπ${totalCpr}</td>
          <td class="px-2 py-2 border text-right">${totalResultRate}</td>
          <td class="px-2 py-2 border text-right">${totalCtr}</td>
          <td class="px-2 py-2 border text-right">‚Çπ${totalCpc}</td>
        </tr>
      `;
    }
    
    // Download PDF
    function downloadPDF() {
      window.print();
    }
    
    // Initialize
    updateUI();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d58327145e3613f',t:'MTc3MjM2ODQ3OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
